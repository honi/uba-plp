# Ejercicio 13

```smalltalk
Object subclass: Counter [
    |count| "Instance variable"

    class << new [
        ^super new initialize: 0.
    ]

    initialize: aValue [
        count := aValue.
        ^self.
    ]

    next [
        self initialize: count + 1.
        ^count.
    ]

    nextIf: condition [
        ^condition ifTrue: [self next] ifFalse: [count]
    ]
]
```

```smalltalk
Counter subclass: FlexibleCounter [
    |block| "Instance variable"

    class << new: aBlock [
        ^super new useBlock: aBlock.
    ]

    useBlock: aBlock [
        block := aBlock.
        ^self.
    ]

    next [
        self initialize: (block value: count).
        ^count.
    ]
]
```

## Seguimiento

```smalltalk
aCounter := FlexibleCounter new: [ :v | v+2 ].
```


| Objeto | Mensaje | Colaboradores | Implementado en | Resultado |
|--------|---------|---------------|-----------------|-----------|
| `FlexibleCounter` | `new:` | `[ :v \| v+2 ]` | `FlexibleCounter` | `aCounter` |
| `Counter` | `new` | | `Counter` | `aCounter` |
| `Object` | `new` | | `Object` | `aCounter` |
| `aCounter` | `initialize:` | `0` | `Counter` | `aCounter` |
| `aCounter` | `useBlock:` | `[ :v \| v+2 ]` | `FlexibleCounter` | `aCounter` |

```smalltalk
aCounter nextIf: true.
```

| Objeto | Mensaje | Colaboradores | Implementado en | Resultado |
|--------|---------|---------------|-----------------|-----------|
| `aCounter` | `nextIf:` | `true` | `Counter` | `2` |
| `true` | `ifTrue:ifFalse:` | `[self next]`, `[0]` | `True` | `2` |
| `[self next]` | `value` | | `BlockClosure` | `2` |
| `aCounter` | `next` | | `FlexibleCounter` | `2` |
| `[ :v \| v+2 ]` | `value:` | `0` | `BlockClosure` | `2` |
| `0` | `+` | `2` | `SmallInteger` | `2` |
| `aCounter` | `initialize:` | `2` | `Counter` | `aCounter` |
